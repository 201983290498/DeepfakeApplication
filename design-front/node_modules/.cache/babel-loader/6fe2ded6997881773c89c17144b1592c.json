{"ast":null,"code":"import $ from 'jquery';\nexport default {\n  name: 'ServiceDisplay',\n  data() {\n    return {\n      activeBox: 'example1'\n    };\n  },\n  watch: {\n    activeBox: function (newValue, oldValue) {\n      // 根据活跃的值,自动更新选中的小阴影框\n      if (oldValue !== '') {\n        $('#' + oldValue + ' div').addClass('wrap-mask');\n      }\n      if (newValue !== '') {\n        $('#' + newValue + ' div').removeClass('wrap-mask');\n      }\n    }\n  },\n  props: {\n    disImgs: []\n  },\n  methods: {\n    changeDisboard: function (event) {\n      // todo 带学习 addClass和removeClass函数的正确用法, 存在不重复添加，不存在删除不报错\n      const _this = this;\n      const activeBox = $(event.target).parent().attr('id');\n      _this.activeBox = activeBox;\n      _this.getBase64($('#' + _this.activeBox + ' img').attr('src'));\n    },\n    getBase64(imgUrl) {\n      // todo 根据图片本地的url获取base64字符串 主要用于main-box的图像获取，效率较低\n      const _this = this;\n      const image = new Image();\n      image.crossOrigin = '';\n      image.src = imgUrl;\n      // todo 待学习知识点 Deffered相关的用法 https://blog.csdn.net/qq_38888512/article/details/105478986\n      const deffered = $.Deferred();\n      if (imgUrl) {\n        image.onload = function () {\n          const data = _this.getBase64Image(image);\n          $('#mainBox img').attr('src', data);\n          // todo 待更新，需要添加扫描的特效 和传递给父亲元素效果\n          _this.upload(data, imgUrl);\n          deffered.resolve(data);\n        };\n        return deffered.promise();\n      }\n    },\n    getBase64Image(img) {\n      const canvas = document.createElement('canvas');\n      canvas.width = img.width;\n      canvas.height = img.height;\n      const ctx = canvas.getContext('2d');\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      return canvas.toDataURL();\n    },\n    upload(imgBase64, imgUrl) {\n      const img = {};\n      const _this = this;\n      img.name = imgUrl.substring(imgUrl.lastIndexOf('/') + 1);\n      img.type = imgBase64.substring(imgBase64.indexOf(':') + 1, imgBase64.indexOf(';'));\n      img.size = 0;\n      img.base64 = imgBase64;\n      _this.$emit('upload', img);\n    },\n    updateImage: function (img) {\n      $('.display-main img').attr('src', img.base64);\n    },\n    changeDisboardToTask: function (img) {\n      // 显示任务视图\n      const _this = this;\n      _this.activeBox = '';\n      _this.updateImage(img);\n    }\n  },\n  mounted() {\n    const _this = this;\n    $('.example div').addClass('wrap-mask');\n    $('#' + _this.activeBox + ' div').removeClass('wrap-mask');\n    _this.getBase64($('#' + _this.activeBox + ' img').attr('src'));\n  }\n};","map":{"version":3,"mappings":"AAuBA;AACA;EACAA;EACAC;IACA;MACAC;IACA;EACA;EACAC;IACAD;MAAA;MACA;QACAE;MACA;MACA;QACAA;MACA;IACA;EACA;EACAC;IACAC;EACA;EACAC;IACAC;MACA;MACA;MACA;MACAC;MACAA;IACA;IACAC;MAAA;MACA;MACA;MACAC;MACAA;MACA;MACA;MACA;QACAA;UACA;UACAP;UACA;UACAK;UACAG;QACA;QACA;MACA;IACA;IACAC;MACA;MACAC;MACAA;MACA;MACAC;MACA;IACA;IACAC;MACA;MACA;MACAC;MACAA;MACAA;MACAA;MACAR;IACA;IACAS;MACAd;IACA;IACAe;MAAA;MACA;MACAV;MACAA;IACA;EAEA;EACAW;IACA;IACAhB;IACAA;IACAK;EACA;AACA","names":["name","data","activeBox","watch","$","props","disImgs","methods","changeDisboard","_this","getBase64","image","deffered","getBase64Image","canvas","ctx","upload","img","updateImage","changeDisboardToTask","mounted"],"sourceRoot":"src/components","sources":["ServiceDisplay.vue"],"sourcesContent":["<template>\r\n  <div class=\"service-display\">\r\n    <div class=\"display-main inb\" id=\"mainBox\">\r\n      <img />\r\n    </div> <div class=\"display-minor inb\">\r\n<!--  图片框加上遮罩  -->\r\n      <div class=\"example\" id=\"example1\" @click=\"changeDisboard\">\r\n        <img :src=\"disImgs[0]\"/>\r\n        <div></div>\r\n      </div>\r\n      <div class=\"example\" id=\"example2\" @click=\"changeDisboard\" >\r\n        <img :src=\"disImgs[1]\"/>\r\n        <div></div>\r\n      </div>\r\n      <div class=\"example\" id=\"example3\" @click=\"changeDisboard\" >\r\n        <img :src=\"disImgs[2]\"/>\r\n        <div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport $ from 'jquery'\r\nexport default {\r\n  name: 'ServiceDisplay',\r\n  data () {\r\n    return {\r\n      activeBox: 'example1'\r\n    }\r\n  },\r\n  watch: {\r\n    activeBox: function (newValue, oldValue) { // 根据活跃的值,自动更新选中的小阴影框\r\n      if (oldValue !== '') {\r\n        $('#' + oldValue + ' div').addClass('wrap-mask')\r\n      }\r\n      if (newValue !== '') {\r\n        $('#' + newValue + ' div').removeClass('wrap-mask')\r\n      }\r\n    }\r\n  },\r\n  props: {\r\n    disImgs: []\r\n  },\r\n  methods: {\r\n    changeDisboard: function (event) {\r\n      // todo 带学习 addClass和removeClass函数的正确用法, 存在不重复添加，不存在删除不报错\r\n      const _this = this\r\n      const activeBox = $(event.target).parent().attr('id')\r\n      _this.activeBox = activeBox\r\n      _this.getBase64($('#' + _this.activeBox + ' img').attr('src'))\r\n    },\r\n    getBase64 (imgUrl) {     // todo 根据图片本地的url获取base64字符串 主要用于main-box的图像获取，效率较低\r\n      const _this = this\r\n      const image = new Image()\r\n      image.crossOrigin = ''\r\n      image.src = imgUrl\r\n      // todo 待学习知识点 Deffered相关的用法 https://blog.csdn.net/qq_38888512/article/details/105478986\r\n      const deffered = $.Deferred()\r\n      if (imgUrl) {\r\n        image.onload = function () {\r\n          const data = _this.getBase64Image(image)\r\n          $('#mainBox img').attr('src', data)\r\n          // todo 待更新，需要添加扫描的特效 和传递给父亲元素效果\r\n          _this.upload(data, imgUrl)\r\n          deffered.resolve(data)\r\n        }\r\n        return deffered.promise()\r\n      }\r\n    },\r\n    getBase64Image (img) {\r\n      const canvas = document.createElement('canvas')\r\n      canvas.width = img.width\r\n      canvas.height = img.height\r\n      const ctx = canvas.getContext('2d')\r\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height)\r\n      return canvas.toDataURL()\r\n    },\r\n    upload (imgBase64, imgUrl) {\r\n      const img = {}\r\n      const _this = this\r\n      img.name = imgUrl.substring(imgUrl.lastIndexOf('/') + 1)\r\n      img.type = imgBase64.substring(imgBase64.indexOf(':') + 1, imgBase64.indexOf(';'))\r\n      img.size = 0\r\n      img.base64 = imgBase64\r\n      _this.$emit('upload', img)\r\n    },\r\n    updateImage: function (img) {\r\n      $('.display-main img').attr('src', img.base64)\r\n    },\r\n    changeDisboardToTask: function (img) { // 显示任务视图\r\n      const _this = this\r\n      _this.activeBox = ''\r\n      _this.updateImage(img)\r\n    }\r\n\r\n  },\r\n  mounted () {\r\n    const _this = this\r\n    $('.example div').addClass('wrap-mask')\r\n    $('#' + _this.activeBox + ' div').removeClass('wrap-mask')\r\n    _this.getBase64($('#' + _this.activeBox + ' img').attr('src'))\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.service-display{\r\n  padding: 10px 0;\r\n}\r\n.inb{\r\n  display: inline-block\r\n}\r\n.display-main{\r\n  width: 70%;\r\n  height: 430px;\r\n  margin-right: 10px;\r\n  margin-bottom: 20px;\r\n  border-radius: 40px;\r\n  background-color: #211004;\r\n  vertical-align: top;\r\n  overflow: hidden;\r\n}\r\n.display-minor{\r\n  vertical-align: top;\r\n  width: 25%;\r\n}\r\n.example {\r\n  height: 140px;\r\n  margin-bottom: 10px;\r\n  border-radius: 16px !important;\r\n  background-color: #211004;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.example img, .display-main img{\r\n  object-fit: contain;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n.wrap-mask{\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  left: 0;\r\n  top: 0;\r\n  z-index: 1;\r\n  background-color: rgba(0,0,0,.4);\r\n  border-radius: 16px;\r\n}\r\n\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}